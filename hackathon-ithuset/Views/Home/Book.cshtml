@model hackathon_ithuset.Models.BookViewModel
@{
    ViewBag.Title = "Book";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Book</h2>

<div id="book"></div>
<div id="related"></div>

@section ascripts {

    <script>
        $(document).ready(function () {
            var model = @Html.Raw(Json.Encode(Model));

            GetRelatedBookInformation(model.isbn);

            for (var i = 0; i < model.relatedisbns.length; i++) {
                GetRelatedBookInformation(model.relatedisbns[i]);
            }
        });

        function GetBookInformation() {}

        function GetRelatedBookInformation(isbn) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var jsonobj = JSON.parse(this.responseText);
                    var list = jsonobj.xsearch.list;

                    $("#related").append("<div class='search-result'>" + 
                                        "<h3> Title: " + list[0].title + "</h3>" +
                                        "<h5> Cteator: " + list[0].creator + "</h5>" +
                                        "<br>" + 
                                        "<strong> Date: </strong>" + list[0].date +
                                        "<br>" + 
                                        "<strong> Language: " + list[0].language +
                                        "<br>" +
                                        "<a href='/Home/Book/" + isbn + "'>View related Book</a>" + 
                                        "</div>");
                }
            }
            xhttp.open("GET", "http://libris.kb.se/xsearch?query=isbn:" + isbn + "&format=json", true);
            xhttp.send();
        }
    </script>
}